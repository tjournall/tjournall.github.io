<!DOCTYPE html>
<!--


/╲/\[☉﹏☉]/\╱\ <-- Паук! Ааа! 🕷️


-->
<html>
    <head>
        <meta charset="utf-8">

        <meta name="yandex-tableau-widget" content="logo=https://leonardo.osnova.io/36b7a01f-f71d-eee8-d36c-a58fc4d37391/, color=#fff4e2" />
        <title> на TJ</title>

        <!-- Viewport -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

        
                    <!-- Mobile App Banner -->
            <meta name="apple-itunes-app" content="app-id=683103523, app-argument=tjru://index">
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,400i,500,700&amp;subset=cyrillic,cyrillic-ext,latin-ext">

        <!-- Meta -->
        <meta property="twitter:card" content="summary_large_image" />
<meta property="og:site_name" content="TJ" />
<meta property="fb:app_id" content="506675079378064" />
<meta property="vk:image" content="https://tjournal.ru/cover/vk/c/393004/1622995246/cover.jpg" />
<meta property="twitter:image" content="https://tjournal.ru/cover/tw/c/393004/1622995246/cover.jpg" />
<meta property="og:image" content="https://tjournal.ru/cover/fb/c/393004/1622995246/cover.jpg" />
<meta property="og:image:width" content="600" />
<meta property="og:image:height" content="315" />
<meta property="og:title" content=" на TJ" />
<meta property="og:type" content="article" />
<meta property="og:description" content="Все три сайта используют общую платформу, поэтому принцип написания ботов для каждого их этих сайтов одинаков. Все примеры в этой статье будут для TJ. Погнали!" />
<meta name="description" content="Все три сайта используют общую платформу, поэтому принцип написания ботов для каждого их этих сайтов одинаков. Все примеры в этой статье будут для TJ. Погнали!" />
<meta property="og:url" content="https://tjournal.ru/u/368039-moguchaya-kuchka/393004" />
<link rel="canonical" href="https://tjournal.ru/u/368039-moguchaya-kuchka/393004">
<meta name="author" content="Могучая кучка" />
<meta property="article:author" content="https://www.facebook.com/tjournal/" />
<meta property="article:publisher" content="https://www.facebook.com/tjournal/" />
<meta property="article:published_time" content="2021-06-06T19:00:46+03:00" />
<link rel="image_src" href="https://tjournal.ru/cover/fb/c/393004/1622995246/cover.jpg">

        <meta name="twitter:card" content="summary_large_image" />

        <!-- Header color -->
        
        <!-- Favicons -->
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <link rel="icon" type="image/png" href="../../img/apple-touch-icon-180x180.png">
        <link rel="apple-touch-icon" href="../../img/apple-touch-icon-180x180.png">
        <link rel="mask-icon" href="../../img/safari-pinned-tab.svg" color="#E8A427">

        
        <link rel="stylesheet" href="../../css/main.13a984d7.min.css">

        <link rel="manifest" href="../../json/gcm-manifest.json">

        <meta name="msapplication-tile-image" content="../../img/mstile-150x150.png">

        <!-- Chrome, Firefox OS and Opera -->
        <meta name="theme-color" content="#fff4e2">
        <!-- Windows Phone -->
        <meta name="msapplication-navbutton-color" content="#fff4e2">
        <!-- iOS Safari -->
        <meta name="apple-mobile-web-app-status-bar-style" content="#fff4e2">

                        <script>
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NDH47H');
    </script>
        
        <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Organization",
        "name": "TJ",
        "url": "https://tjournal.ru/",
        "logo": "https://tjournal.ru/static/build/tjournal.ru/images/search_logo.png",
        "sameAs":
            
            [
    "https:\/\/facebook.com\/tjournal",
    "https:\/\/vk.com\/tj",
    "https:\/\/twitter.com\/tjournal",
    "https:\/\/t.me\/TJournal",
    "\/rss\/all"
]    }
</script>

        <!-- Google AdSense verification for RTB -->
                    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4047172970672323"
     crossorigin="anonymous"></script>
<!-- Tj-vertical -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4047172970672323"
     data-ad-slot="9077599732"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
            </head>

    
    <body class="app app--content-entry app--left-column-on app--right-column-on app--propaganda-on app--livestream-on app--content-sidebar-align-right app--right-column-reserve-off app--live-auto" data-country-code="UA" data-one-name="body">
        <script>
            /**
             * Dealing with adblock class:
             */

            function getCookie(name) {
              return (name = (document.cookie + ';').match(new RegExp(name + '=.*;'))) && name[0].split(/=|;/)[1];
            }

            if (getCookie('adblock-state') == 1) {
                document.body.classList.add('app--ad-blocked');
            } else {
                document.body.classList.add('app--ad-allowed');
            }
        </script>

                    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NDH47H" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
        
        <!-- Adfox "D 100%x150 / 100%х250" format -->
        
<div class="propaganda" data-id="1"></div>

        <div class="site-header-container">
    <vue name="site-header"></vue>
</div>

        <!-- Adfox "M 1200x400/600" format -->
        
<div class="propaganda" data-id="2"></div>

        
<div class="propaganda" data-id="17"></div>

        
<div class="propaganda" data-id="18"></div>

        <div class="updown" air-module="module.updown" air-click="updown" air-dom="updown">
            <div class="updown__icons">
                
                    <svg class="icon icon--ui_arrow_up" width="10" height="6" xmlns="http://www.w3.org/2000/svg"><use xlink:href="#ui_arrow_up"></use></svg>
                
                    <svg class="icon icon--ui_arrow_up" width="10" height="6" xmlns="http://www.w3.org/2000/svg"><use xlink:href="#ui_arrow_up"></use></svg>
                
                    <svg class="icon icon--ui_arrow_up" width="10" height="6" xmlns="http://www.w3.org/2000/svg"><use xlink:href="#ui_arrow_up"></use></svg>
                            </div>
        </div>

        <div class="main layout">

            <div class="layout__left-column layout__sticky">
                <vue name="sidebar"></vue>
                <div class="sidebar__tint"></div>
            </div>

            <div class="layout__content l-relative">

                <!-- Adfox branding -->
                <div id="adfox-branding-shifter"></div>
                <div id="adfox-branding" class="lm-hidden"></div>
                
<div class="propaganda" data-id="4"></div>

                <div id="page_wrapper">

                    
    <!-- Adfox "Микроостров под шапкой DM" format -->
    
<div class="propaganda" data-id="21"></div>

    
<!-- Render special in the entry top -->
    
<!-- Native support banner -->
    

<!-- #мегафон_какэтоработает branding -->


<!-- Native branding from subsite settings -->
    <!-- #ДРМ_конкурс branding article header -->
    
<!-- #vcru_spotify branding -->

<!-- Special Igrozhur -->

<div class="page page--entry">
            
<div air-module="module.distributionFloating">
    <air-settings>{"id":2175,"url":"\/distributions\/2175\/click?bit=1&hash=803b6e1bcbd9dfc4ba9456fda887a878c80d24df8d3a575913b14876e18923a5","title":"TJ \u0437\u0430\u043a\u0440\u043e\u0435\u0442\u0441\u044f 10 \u0441\u0435\u043d\u0442\u044f\u0431\u0440\u044f \u2014\u00a0\u043f\u0440\u043e\u0447\u0438\u0442\u0430\u0439\u0442\u0435 \u0430\u043d\u043e\u043d\u0441 \u0441 \u0434\u0435\u0442\u0430\u043b\u044f\u043c\u0438","buttonText":"\u0427\u0438\u0442\u0430\u0442\u044c","imageUuid":"d1d355d8-93a3-5140-aeae-14b03046b760","isPaidAndBannersEnabled":false}</air-settings>
</div>
    
    <!-- Microdata for search engines -->
    
<script type="application/ld+json">
  {"@context":"http:\/\/schema.org","@graph":[{"@type":"BreadcrumbList","itemListElement":{"@type":"ListItem","position":1,"item":{"@id":"\/\/tjournal.ru\/u\/368039-moguchaya-kuchka","name":"\u041c\u043e\u0433\u0443\u0447\u0430\u044f \u043a\u0443\u0447\u043a\u0430"}}},{"@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/tjournal.ru\/u\/368039-moguchaya-kuchka\/393004"},"@id":393004,"headline":"","image":{"@type":"ImageObject","url":"https:\/\/tjournal.ru\/cover\/fb\/c\/393004\/1622995246\/cover.jpg","width":1200,"height":630},"datePublished":"2021-06-06T19:00:46+03:00","dateModified":"2021-06-06T19:00:46+03:00","text":"\u0412\u0441\u0435 \u0442\u0440\u0438 \u0441\u0430\u0439\u0442\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442 \u043e\u0431\u0449\u0443\u044e \u043f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u0443, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u043f\u0440\u0438\u043d\u0446\u0438\u043f \u043d\u0430\u043f\u0438\u0441\u0430\u043d\u0438\u044f \u0431\u043e\u0442\u043e\u0432 \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0438\u0445 \u044d\u0442\u0438\u0445 \u0441\u0430\u0439\u0442\u043e\u0432 \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432. \u0412\u0441\u0435 \u043f\u0440\u0438\u043c\u0435\u0440\u044b \u0432 \u044d\u0442\u043e\u0439 \u0441\u0442\u0430\u0442\u044c\u0435 \u0431\u0443\u0434\u0443\u0442 \u0434\u043b\u044f TJ. \u041f\u043e\u0433\u043d\u0430\u043b\u0438!","author":[{"@type":"Person","name":"\u041c\u043e\u0433\u0443\u0447\u0430\u044f \u043a\u0443\u0447\u043a\u0430 368039"}],"publisher":{"@type":"Organization","name":"TJ","logo":{"@type":"ImageObject","url":"https:\/\/tjournal.ru\/static\/build\/tjournal.ru\/images\/amp_logo.png","width":60,"height":60}},"about":[{"@type":"Event","name":"ArticleUGC"}],"url":"https:\/\/tjournal.ru\/u\/368039-moguchaya-kuchka\/393004"}]}
</script>

    

    <!-- Custom css from subsite settings -->
    

    <div class="l-entry  l-island-bg l-island-round lm-pt-16 l-pt-24 l-pb-30 " air-module="module.entry" data-content-id="393004" air-entry-type="full">

        <!-- Применить версию из истории статьи -->
        
                    <div class="l-entry__header l-island-a">
                

<div class="
content-header
content-header--empty-title"
>

    <div class="content-header__info">
        
                <a class="content-header-author content-header-author--subsite content-header__item" href="https://tjournal.ru/u/368039-moguchaya-kuchka">
            <div class="content-header-author__avatar">
                
<img
    class="andropov_image "
    air-module="module.andropov"
    data-andropov-type="image"
    data-image-src="https://leonardo.osnova.io/b012476b-a9da-59fd-ab33-935759ac940e/"
    data-image-name=""
            style=";background-color: #5c710f;"            src="data:image/gif;base64,R0lGODlhAQABAJAAAP8AAAAAACH5BAUQAAAALAAAAAABAAEAAAICBAEAOw=="/>            </div>

            <div class="content-header-author__name">
                Могучая кучка            </div>

                    </a>

                
                <div class="content-header__item content-header-number">
                            <span class="lm-hidden">
                    <time class="time" air-module="module.date" data-date="1622995246" data-type="default" title="06.06.2021 19:00:46 (Europe/Moscow)">6&nbsp;июн&nbsp;2021</time>                </span>
                <span class="l-hidden lm-inline">
                    <time class="time" air-module="module.date" data-date="1622995246" data-type="medium" title="06.06.2021 19:00:46 (Europe/Moscow)">6.06.2021</time>                </span>
                    </div>
    </div>

    <div class="content-header__spacer"></div>

        
        
        </div>


            </div>
        
        <div class="l-entry__content">

            <div data-io-article-url="https://tjournal.ru/u/368039-moguchaya-kuchka/393004">

                
<div class="content content--full ">
            
        
        
        
            <div class="l-island-a">
    
        <p>Все три сайта используют общую платформу, поэтому принцип написания ботов для каждого их этих сайтов одинаков. Все примеры в этой статье будут для TJ. Погнали!</p>
    </div>

        
        
            
            
                
<div class="content-info content-info--full l-island-a">
    
                
                            <div class="content-info__item">
                
<vue name="bookmark">
    <textarea hidden class="l-hidden">
        {&quot;id&quot;:393004,&quot;type&quot;:1,&quot;typeStr&quot;:&quot;content&quot;,&quot;showTitle&quot;:false,&quot;initialState&quot;:{&quot;isActive&quot;:false},&quot;gtm&quot;:&quot;&quot;}    </textarea>
</vue>
            </div>
        
                <div class="content-info__item lm-hidden">
            
<!--googleoff: all-->
<!--noindex-->

<vue name="layout-shares">
    <textarea hidden>
        {"id":393004,"gtm":null}    </textarea>
</vue>

<!--/noindex-->
<!--googleon: all-->
        </div>


    
                <div class="content-info__item content-info__item--right">
            
<div
    class="views"

    
        air-module="module.entryViews"

    
    data-content-id="393004"
    data-value="0"
    data-compact=""
>
    
    <span class="views__value">0</span>

            <span class="views__label">просмотров</span>
    </div>
        </div>
    
        </div>

            
        
            
        
        
        
            <h2>
    <div class="l-island-a">
        1. Получение токена    </div>
</h2>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>Первое что нужно сделать это получить токен для API. Он нужен чтобы вызывать методы API, через которые и будет работать наш бот. Выглядит он примерно так:</p>
    </div>

        
        
            
            
        
            
        
        
        
            <figure>
    <div class="l-island-a">
        <div class="block-code" air-module="module.code">a0b002cbb010d4b321ddd8cff46b58bf7e93f77dccf60b20fc950bd752511753</div>
    </div>
</figure>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>В идеале стоит зарегистрировать нового пользователя, который будет совершать действия от имени бота на сайте. Но API токен выдается новым пользователям не сразу, а через 24 часа. Начать можно и без регистрации нового пользователя или его токена, а использовать API токен своего основного пользователя хотя бы для подписки на новые комментарии.</p>
    </div>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>Идем в настройки профиля и прокручиваем в самый низ пока не увидим ссылку "Инструменты для разработчика".</p>
    </div>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>Нажимаем на нее и получаем попап с токеном и ссылкой на <a href="https://www.notion.so/API-TJ-vc-ru-DTF-3f5162d2cb184f6381ff82c085bbb3c0" rel="nofollow noreferrer noopener" target="_blank">документацию API</a>. </p>
    </div>

        
        
            
            
        
            
        
        
        
            
    
<figure class="figure-image">
    <style>
        @media (min-width: 1197px) {
            .content-image--12bbecb9-fb7f-5050-aeb5-436a7cdbdfef {
                --offset: 0px;
            }
        }
    </style>

    <div class="l-island-c">
        <div class="content-image content-image--12bbecb9-fb7f-5050-aeb5-436a7cdbdfef">
            
<div
    class="andropov_image "
    style="max-height: 606px;max-width: 1196px;"
    air-module="module.andropov"
    data-andropov-type="image"
    data-image-width="1196"
    data-image-height="606"
    data-image-max-width="1196"    data-image-max-height="606"            data-image-src="https://leonardo.osnova.io/12bbecb9-fb7f-5050-aeb5-436a7cdbdfef/">

    <div class="andropov_image__inner" style=";padding-bottom: 50.6688%;background: linear-gradient(90deg, #2a2a2a, #ffffff);"></div>
</div>
        </div>

            </div>
</figure>
        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>(Если вместо попапа всплывает ошибка 214, то 24 часа еще не прошло с момента регистрации юзера и нужно ПОТЕРПЕТЬ!)</p>
    </div>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>Сохраняем токен для последующего использования.</p>
    </div>

        
        
            
            
        
            
        
        
        
            <h2>
    <div class="l-island-a">
        2. Запускаем приложение    </div>
</h2>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>Чтобы бот реагировал на какой-то текст или свое упоминание в комментарии, он должен видеть все комментарии. У платформы для этого существует <a href="https://www.notion.so/dd8bf6f5c1fd430286530644d4c362df" rel="nofollow noreferrer noopener" target="_blank">механизм вебхуков</a>. Из чего следует, что для написания бота нам нужен хостинг, а сам бот будет веб-приложением. Собственно хостинг и есть самое сложное в написании бота.</p>
    </div>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>Для нашей разработки будем использовать сервис <a href="https://glitch.com" rel="nofollow noreferrer noopener" target="_blank">glitch</a>. Он бесплатен (до определенного уровня), позволяет писать код прямо в браузере и получать работающее веб-приложение, что идеально для наших целей. В качестве альтернативы можно использовать любой другой хостинг.</p>
    </div>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>Регистрируемся по <a href="https://glitch.com/signup" rel="nofollow noreferrer noopener" target="_blank">ссылке</a> и переходим в Dashboard.</p>
    </div>

        
        
            
            
        
            
        
        
        
            
    
<figure class="figure-image">
    <style>
        @media (min-width: 2361px) {
            .content-image--ef2c65b4-e85d-55a6-b00f-64776cd56013 {
                --offset: 0px;
            }
        }
    </style>

    <div class="l-island-c">
        <div class="content-image content-image--ef2c65b4-e85d-55a6-b00f-64776cd56013">
            
<div
    class="andropov_image "
    style="max-height: 480px;max-width: 2360px;"
    air-module="module.andropov"
    data-andropov-type="image"
    data-image-width="2360"
    data-image-height="480"
    data-image-max-width="2360"    data-image-max-height="480"            data-image-src="https://leonardo.osnova.io/ef2c65b4-e85d-55a6-b00f-64776cd56013/">

    <div class="andropov_image__inner" style=";padding-bottom: 20.3388%;background: linear-gradient(90deg, #f2f2f3, #f2f2f3);"></div>
</div>
        </div>

            </div>
</figure>
        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>Выбираем Minimal Node и попадаем в редактор. </p>
    </div>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>Слева видим список файлов. Нас инетересует два файла: package.json и server.js. Окрывем package.json и заменяем</p>
    </div>

        
        
            
            
        
            
        
        
        
            <figure>
    <div class="l-island-a">
        <div class="block-code" air-module="module.code">&quot;dependencies&quot;: {
  &quot;fastify&quot;: &quot;^3.14.1&quot;,
  &quot;fastify-formbody&quot;: &quot;^5.0.0&quot;,
  &quot;fastify-static&quot;: &quot;^4.0.0&quot;,
  &quot;handlebars&quot;: &quot;^4.7.7&quot;,
  &quot;point-of-view&quot;: &quot;^4.14.0&quot;
},</div>
    </div>
</figure>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>(или что-то похожее) на</p>
    </div>

        
        
            
            
        
            
        
        
        
            <figure>
    <div class="l-island-a">
        <div class="block-code" air-module="module.code">&quot;dependencies&quot;: {
  &quot;express&quot;: &quot;^4.17.1&quot;,
  &quot;request&quot;: &quot;^2.88.2&quot;
},</div>
    </div>
</figure>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>Затем открываем server.js и заменяем его содержимое на:</p>
    </div>

        
        
            
            
        
            
        
        
        
            <figure>
    <div class="l-island-a">
        <div class="block-code" air-module="module.code">'use strict';

const express = require('express')
const bodyParser = require('body-parser')
const app = express()
const webappUrl = &quot;https://&quot; + process.env.PROJECT_NAME + &quot;.glitch.me&quot;

// Главная страница, чтобы видеть, что все работает      
app.get('/', (req, res) =&gt; {
  res.send('( ͡&deg; ͜ʖ ͡&deg;)')
})

// Эндпоинт для вебхука
app.post('/new-comment/tj', bodyParser.json(), (req, res) =&gt; {
  res.send('')
  console.log(req.body.data)
})

// Запускаем веб-сервер
app.listen(process.env.PORT, () =&gt; {
  console.log(`Webapp started @ ${webappUrl}`)
})</div>
    </div>
</figure>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>Код разбирать не буду ибо это не туториал по JS. Но в принципе даже незнакомому с JS человеку должно быть понятно что он делает. </p>
    </div>

        
        
            
            
        
            
                                    <div class="l-island-a">
                    
<div class="propaganda" data-id="13"></div>
                </div>
                    
        
        
            <div class="l-island-a">
    
        <p>В самом правом блоке с превью должен появится <mark class="cdx-marked-text marked-text">( ° ʖ °)</mark> (редактор, зачем ты так с lenny face?). Это значит, что все идет по плану. Если нет, можно посмотреть в логах что не так.</p>
    </div>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>Открываем логи (Tools &gt; Logs), там должно быть что-то вроде</p>
    </div>

        
        
            
            
        
            
        
        
        
            <figure>
    <div class="l-island-a">
        <div class="block-code" air-module="module.code">Webapp started @ https://bla-bla-rest.glitch.me</div>
    </div>
</figure>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>https://bla-bla-rest.glitch.me это адрес песочницы, по которому доступно наше приложение. Везде где дальше упоминается этот адрес, нужно заменять его на свой реальный адрес песочницы. На всякий случай можно проверить, что бот понимает запросы сгенерировав запрос вручную в командной строке через curl:</p>
    </div>

        
        
            
            
        
            
        
        
        
            <figure>
    <div class="l-island-a">
        <div class="block-code" air-module="module.code">curl -X POST \
  --header &quot;Content-Type: application/json&quot; \
  --data '{&quot;type&quot;:&quot;new_comment&quot;,&quot;data&quot;:{&quot;id&quot;:&quot;5583467&quot;,&quot;reply_to&quot;:{&quot;id&quot;:&quot;00999&quot;,&quot;creator&quot;:{&quot;id&quot;:&quot;401824&quot;}},&quot;content&quot;:{&quot;id&quot;:&quot;342564&quot;},&quot;text&quot;:&quot;Да&quot;}}' \
  https://bla-bla-rest.glitch.me/new-comment/tj</div>
    </div>
</figure>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>В логах должна появиться запись:</p>
    </div>

        
        
            
            
        
            
        
        
        
            <figure>
    <div class="l-island-a">
        <div class="block-code" air-module="module.code">{
  id: '5583467',
  reply_to: { id: '00999', creator: { id: '401824' } },
  content: { id: '342564' },
  text: 'Да'
}</div>
    </div>
</figure>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>Это значит что все хорошо.</p>
    </div>

        
        
            
            
        
                                
        
        
        
            <h2>
    <div class="l-island-a">
        3. Подписываемся на комментарии    </div>
</h2>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>На этом этапе наш бот готов получать реальные комментарии с сайта. Для этого отправляем запрос к API:</p>
    </div>

        
        
            
            
        
            
        
        
        
            <figure>
    <div class="l-island-a">
        <div class="block-code" air-module="module.code">curl -X POST \
  --header 'X-Device-Token: YOUR_API_TOKEN' \
  --form 'url=https://bla-bla-rest.glitch.me/new-comment/tj' \
  --form 'event=new_comment' \
  https://api.tjournal.ru/v1.8/webhooks/add</div>
    </div>
</figure>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>YOUR_API_TOKEN здесь это API токен, который мы получили в пункте 1. API ответит:</p>
    </div>

        
        
            
            
        
            
        
        
        
            <figure>
    <div class="l-island-a">
        <div class="block-code" air-module="module.code">{&quot;message&quot;:&quot;&quot;,&quot;result&quot;:{&quot;id&quot;:9999999,&quot;url&quot;:&quot;https:\/\/bla-bla-rest.glitch.me\/new-comment\/tj&quot;}}</div>
    </div>
</figure>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>А в лог будут добавляться все комменты с сайта. Полюбуемся на процесс какое-то время и отпишемся от комментариев, чтобы не тратить бесплатную квоту почем зря:</p>
    </div>

        
        
            
            
        
            
        
        
        
            <figure>
    <div class="l-island-a">
        <div class="block-code" air-module="module.code">curl -X POST \
  --header 'X-Device-Token: YOUR_API_TOKEN' \
  --form 'event=new_comment' \
  https://api.tjournal.ru/v1.8/webhooks/del</div>
    </div>
</figure>

        
        
            
            
        
            
        
        
        
            <h2>
    <div class="l-island-a">
        4. Пишем ответы от имени бота    </div>
</h2>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>Добавим в наш код пару функций, которые позволят нам писать комментарии от имени бота:</p>
    </div>

        
        
            
            
        
            
        
        
        
            <figure>
    <div class="l-island-a">
        <div class="block-code" air-module="module.code">const request = require('request')
const apiToken = &quot;YOUR_API_TOKEN&quot;; // Подставить токен из пункта 1

function apiRequest(path, formData) {
  const url = &quot;https://api.tjournal.ru/v1.8&quot; + path
  console.log(url, formData)
  request(
    {
      url: url,
      formData: formData,
      method: &quot;POST&quot;,
      headers: { 'X-Device-Token': apiToken }
    },
    (err, res, body) =&gt; { if (err) { console.log(err); } })
}

function comment(contentId, replyTo, text) {
  var formData = {'id': contentId, 'text': text};
  if (replyTo) formData['reply_to'] = replyTo;
  apiRequest('/comment/add', formData)
}</div>
    </div>
</figure>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>В функцию comment передается:</p>
    </div>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>* contentId - идентификатор поста, к которому нужно оставить комментарий</p>
    </div>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>* replyTo - опциональный идентификатор комментария на который отправляется ответ</p>
    </div>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>* text - текст комментария</p>
    </div>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>А так же добавим логику в эндпоинт для вебхуков:</p>
    </div>

        
        
            
            
        
            
        
        
        
            <figure>
    <div class="l-island-a">
        <div class="block-code" air-module="module.code">var data = req.body.data;
if (data.text.match(/^д+а+[!.]*$/i)) {
  comment(data.content.id, data.id, &quot;Звезда&quot;)
}</div>
    </div>
</figure>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>Новый код использует регулярное выражение и проверяет что комментарий состоит из слова "Да" в любом регистре, с любым количеством повторяющихся букв, с опциональными точками и восклицательными знаками. Вот варианты, которые подходят: "да", "Да", "дА", "ДА!!!", "ДААА", "ДДААААА..." и так далее. На подходящий комментарий он отвечает словом "Звезда". Можете заменить на другое слово по своему усмотрению.</p>
    </div>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>В итоге код server.js будет выглядеть примерно следующим образом:</p>
    </div>

        
        
            
            
        
            
        
        
        
            <figure>
    <div class="l-island-a">
        <div class="block-code" air-module="module.code">'use strict';

const express = require('express')
const bodyParser = require('body-parser')
const request = require('request')
const app = express()
const webappUrl = &quot;https://&quot; + process.env.PROJECT_NAME + &quot;.glitch.me&quot;
const apiToken = &quot;YOUR_API_TOKEN&quot;; // Подставить токен из пункта 1

function apiRequest(path, formData) {
  const url = &quot;https://api.tjournal.ru/v1.8&quot; + path
  console.log(url, formData)
  request(
    {
      url: url,
      formData: formData,
      method: &quot;POST&quot;,
      headers: { 'X-Device-Token': apiToken }
    },
    (err, res, body) =&gt; { if (err) { console.log(err); } })
}

function comment(contentId, replyTo, text) {
  var formData = {'id': contentId, 'text': text};
  if (replyTo) formData['reply_to'] = replyTo;
  apiRequest('/comment/add', formData)
}

// Главная страница, чтобы видеть, что все работает      
app.get('/', (req, res) =&gt; {
  res.send('( ͡&deg; ͜ʖ ͡&deg;)')
})

// Эндпоинт для вебхука
app.post('/new-comment/tj', bodyParser.json(), (req, res) =&gt; {
  res.send('')

  var data = req.body.data;
  if (data.text.match(/^д+а+[!.]*$/i)) {
    comment(data.content.id, data.id, &quot;Звезда&quot;)
  }
})

// Запускаем веб-сервер
app.listen(process.env.PORT, () =&gt; {
  console.log(`Webapp started @ ${webappUrl}`)
})</div>
    </div>
</figure>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>Подписываемся на комментарии как мы делали выше (или как сделано в следующем пункте) и проверяем. </p>
    </div>

        
        
            
            
        
            
        
        
        
            
    
<figure class="figure-image">
    <style>
        @media (min-width: 1223px) {
            .content-image--cab77ac6-5147-5f4b-94bd-bc75103136c3 {
                --offset: 0px;
            }
        }
    </style>

    <div class="l-island-c">
        <div class="content-image content-image--cab77ac6-5147-5f4b-94bd-bc75103136c3">
            
<div
    class="andropov_image "
    style="max-height: 526px;max-width: 1222px;"
    air-module="module.andropov"
    data-andropov-type="image"
    data-image-width="1222"
    data-image-height="526"
    data-image-max-width="1222"    data-image-max-height="526"            data-image-src="https://leonardo.osnova.io/cab77ac6-5147-5f4b-94bd-bc75103136c3/">

    <div class="andropov_image__inner" style=";padding-bottom: 43.0441%;background: linear-gradient(90deg, #323235, #333235);"></div>
</div>
        </div>

            </div>
</figure>
        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>Отвечает!</p>
    </div>

        
        
            
            
        
            
        
        
        
            <h2>
    <div class="l-island-a">
        5. Автоматическая подписка на комментарии    </div>
</h2>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>До сих пор мы подписывали бота на комментарии вручную, но это можно и даже нужно делать автоматически ибо вебхуки могут отключиться по разными причинам.</p><p>Пишем функцию, которая будет добавлять вебхук на комменты, а так же добавляем ее вызов при старте и с определенным интервалом:</p>
    </div>

        
        
            
            
        
            
        
        
        
            <figure>
    <div class="l-island-a">
        <div class="block-code" air-module="module.code">function addWebhook() {
  apiRequest('/webhooks/add', {
    &quot;event&quot;: &quot;new_comment&quot;,
    &quot;url&quot;: webappUrl + '/new-comment/tj'
  })
}

// Запускаем веб-сервер
app.listen(process.env.PORT, () =&gt; {
  addWebhook() // Добавляем вебхук при старте
  setInterval(addWebhook, 3*60000) // Повторяем каждые 3 минуты
  console.log(`Webapp started @ ${webappUrl}`)
})</div>
    </div>
</figure>

        
        
            
            
        
            
        
        
        
            <h2>
    <div class="l-island-a">
        6. Заключение    </div>
</h2>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>За довольно короткое время у нас получился простейший бот, который отвечает на комменты с определенным содержанием. Ну не чудо ли?</p>
    </div>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>Дальше можно расширять бота пока хватает фантазии.</p>
    </div>

        
        
            
            
        
            
        
        
        
            <div class="l-island-a">
    
        <p>Спасибо за внимание, до встречи в срачиках.</p>
    </div>

        
        
            
            
        
    
    
    
<!-- Podcasts on DTF -->

</div>

                                    
<div class="content-footer content-footer--full l-island-a">
        
        <div class="content-footer__item content-footer__item--controls">
        
<vue name="layout-repost">
    <textarea hidden>
        {"contentId":393004,"count":0,"isReposted":false,"gtm":null}    </textarea>
</vue>
    </div>

                <div class="content-footer__item">
            
<vue name="bookmark">
    <textarea hidden class="l-hidden">
        {&quot;id&quot;:393004,&quot;type&quot;:1,&quot;typeStr&quot;:&quot;content&quot;,&quot;showTitle&quot;:false,&quot;initialState&quot;:{&quot;isActive&quot;:false},&quot;gtm&quot;:&quot;&quot;}    </textarea>
</vue>
        </div>
    
        <div class="content-footer__item content-footer__item--share lm-hidden">
        
<!--googleoff: all-->
<!--noindex-->

<vue name="layout-shares">
    <textarea hidden>
        {"id":393004,"gtm":null}    </textarea>
</vue>

<!--/noindex-->
<!--googleon: all-->
    </div>

        </div>
                
            </div>

        </div>

        <div class="l-hidden entry_data"
             data-article-info='{
                "author_name": "Могучая кучка",
                "author_type": "self",
                "tags": [],
                "comments": 0,
                "likes": 67,
                "favorites": 0,
                "is_advertisement": false,
                "subsite_label": "unknown",
                "id": 393004,
                "is_wide": true,
                "is_ugc": true,
                "date": "Sun, 06 Jun 2021 19:00:46 +0300",
                "is_special": false            }'>
        </div>

                
    </div>

            <!-- #мегафон_какэтоработает branding -->
        
        <!-- #ДРМ_конкурс branding article footer-->
        
        <!-- #vcru_spotify branding -->
        
                
        <!-- Native article footer html from subsite settings -->
        
    
            
            <div class="lm-mt-20 l-mt-28"></div>
            
<vue name="promo">
    <textarea hidden class="l-hidden">
        {
            "osnovaUnitId": null,
            "url": "https://booster.osnova.io/a/relevant?site=tj&v=2",
            "place": "entry",
            "site": "tj",
            "settings": {&quot;modes&quot;:{&quot;externalLink&quot;:{&quot;buttonLabels&quot;:[&quot;\u0423\u0437\u043d\u0430\u0442\u044c&quot;,&quot;\u0427\u0438\u0442\u0430\u0442\u044c&quot;,&quot;\u041d\u0430\u0447\u0430\u0442\u044c&quot;,&quot;\u0417\u0430\u043a\u0430\u0437\u0430\u0442\u044c&quot;,&quot;\u041a\u0443\u043f\u0438\u0442\u044c&quot;,&quot;\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c&quot;,&quot;\u0421\u043a\u0430\u0447\u0430\u0442\u044c&quot;,&quot;\u041f\u0435\u0440\u0435\u0439\u0442\u0438&quot;]}},&quot;deviceList&quot;:{&quot;desktop&quot;:&quot;\u0414\u0435\u0441\u043a\u0442\u043e\u043f&quot;,&quot;smartphone&quot;:&quot;\u0421\u043c\u0430\u0440\u0442\u0444\u043e\u043d\u044b&quot;,&quot;tablet&quot;:&quot;\u041f\u043b\u0430\u043d\u0448\u0435\u0442\u044b&quot;}}        }
    </textarea>
</vue>

            <div class="lm-mt-20 l-mt-28"></div>
            

<div class="vacancies_widget l-island-round" air-module="module.vacancy_widget" data-external="1" data-location="entry" data-analytics="Entry — Job Widget">

    <div class="l-island-a l-pv-20">

        <div class="vacancies_widget__header">

            <a href="https://vc.ru/job" class="vacancies_widget__title" data-gtm="Vacancies — Entry Widget — Title — Clicked">Вакансии</a>

            
            <a class="vacancies_widget__new" href="https://vc.ru/job/new" data-gtm="Vacancies — Entry Widget — Create — Clicked">Разместить</a>

        </div>

        <div class="vacancies_widget__items l-mt-17 l-mb-20">

            <div class="placeholder">
                <div class="placeholder__item" style="width: 77%"></div>
                <div class="placeholder__item" style="width: 70%"></div>
                <div class="placeholder__item" style="width: 60%"></div>
                <div class="placeholder__item" style="width: 70%"></div>
                <div class="placeholder__item" style="width: 77%"></div>
            </div>

        </div>

        <div class="vacancies_widget__footer">

            <div class="vacancies_widget__load_more t-link" air-click="vacancies_widget_load_more">
                <span>Показать ещё</span>
                <svg class="icon icon--ui_arrow_down" width="10" height="8" xmlns="http://www.w3.org/2000/svg"><use xlink:href="#ui_arrow_down"></use></svg>            </div>

            
<span class="ui_preloader ">
    <span class="ui_preloader__dot"></span>
    <span class="ui_preloader__dot"></span>
    <span class="ui_preloader__dot"></span>
</span>

            <a href="https://vc.ru/job" class="vacancies_widget__all t-link l-hidden" data-gtm="Vacancies — Entry Widget — All — Clicked">
                <span>Все вакансии</span>
                <svg class="icon icon--ui_arrow_right" width="10" height="10" xmlns="http://www.w3.org/2000/svg"><use xlink:href="#ui_arrow_right"></use></svg>            </a>

        </div>

    </div>

</div>

        
        <!-- Adfox "1020х200 aka 1180х250_Interpool_баннер над комментариями_Desktop" format -->
        
<div class="propaganda" data-id="6"></div>

        <!-- Adfox "Article Footer 100%_desktop_mobile" format -->
        
<div class="propaganda" data-id="7"></div>

        
            <!-- Native teaser before comments -->
            <div class="lm-mt-20 l-mt-28">
                            </div>

        
        <!-- Render special in the entry above comments -->
                            
        
                    
            <div
                class="lm-mt-20 l-mt-28 l-island-a recommendation-feed"
                data-analytics="Recommendations"
                data-clickhouse-analytics="{&quot;show&quot;:&quot;recommendations_viewed&quot;}"
            >
                <div class="feed"
                    air-module="module.feed"
                    data-feed-id="d4396b274c"
                    data-feed-more-url="/recommended"
                    data-feed-last-sorting-value="1"
                    data-feed-last-id=""
                    data-feed-exclude-ids=""
                    data-feed-content-id="393004">

                    <div class="feed__container">
                    </div>

                    <div class="feed__horizon l-pv-25 l-island-round" id="feed_horizon_d4396b274c">
                        
<span class="ui_preloader ">
    <span class="ui_preloader__dot"></span>
    <span class="ui_preloader__dot"></span>
    <span class="ui_preloader__dot"></span>
</span>
                    </div>
                </div>
            </div>

        
    
</div>

                </div>

            </div>

            <div class="layout__right-column">
                
<div class="live" air-module="module.live"></div>
            </div>
        </div>

        <vue name="mobile-site-footer"></vue>

        <!-- Audio Player - temporary place & sons (established in August 2018) -->
        <div class="floating_player floating_player--hidden"></div>

                    <air module="module.propaganda">
                <textarea air-settings>
                    [{"id":1,"label":"Header, 100%x250: D","provider":"adfox","adaptive":["desktop"],"adfox_method":"createAdaptive","auto_reload":true,"adfox":{"ownerId":228129,"params":{"pp":"g","ps":"cndo","p2":"ezfl"}},"distribution":"top-desktop"},{"id":2,"label":"Header, 1200x400\/600: M","provider":"adfox","adaptive":["phone"],"auto_reload":true,"adfox":{"ownerId":228129,"params":{"pp":"g","ps":"cndo","p2":"ezfn"}},"distribution":"top-mobile"},{"id":4,"label":"Article Branding top","provider":"adfox","adaptive":["desktop"],"adfox":{"ownerId":228129,"params":{"p1":"cfovy","p2":"glug"}}},{"id":5,"label":"300x600: D","provider":"adfox","adaptive":["desktop"],"adfox":{"ownerId":228129,"params":{"pp":"g","ps":"cndo","p2":"ezfk"}},"distribution":"right-sidebar"},{"id":6,"label":"Above the Comments: D","provider":"adfox","adaptive":["desktop"],"adfox":{"ownerId":228129,"params":{"pp":"h","ps":"cndo","p2":"ffyh"}},"distribution":"before-comments-desktop"},{"id":7,"label":"Above the Comments: M","provider":"adfox","adaptive":["desktop","tablet","phone"],"adfox":{"ownerId":228129,"params":{"p1":"byswn","p2":"fjxb"}},"distribution":"before-comments-mobile"},{"id":12,"label":"Topbar button: D","provider":"adfox","adaptive":["desktop","tablet"],"auto_reload":true,"adfox":{"ownerId":228129,"params":{"pp":"g","ps":"cndo","p2":"fdhx"}}},{"id":13,"label":"In Article: M","provider":"adfox","adaptive":["phone"],"adfox":{"ownerId":228129,"params":{"pp":"h","ps":"cndo","p2":"flvn"}}},{"id":15,"label":"In-Feed Teaser: DM","provider":"adfox","adaptive":["desktop","tablet","phone"],"adfox":{"ownerId":228129,"params":{"p1":"byudv","p2":"ftjf"}}},{"id":16,"label":"Topbar button: M","provider":"adfox","adaptive":["tablet","phone"],"adfox":{"ownerId":228129,"params":{"p1":"ccydt","p2":"ftwx"}}},{"id":17,"label":"Stratum: D","provider":"adfox","adaptive":["desktop"],"auto_reload":true,"adfox":{"ownerId":228129,"params":{"pp":"g","ps":"cndo","p2":"fzvb"}}},{"id":18,"label":"Stratum: M","provider":"adfox","adaptive":["tablet","phone"],"auto_reload":true,"adfox":{"ownerId":228129,"params":{"pp":"g","ps":"cndo","p2":"fzvc"}}},{"id":19,"label":"Under the News Teaser: DM","provider":"adfox","adaptive":["desktop","tablet","phone"],"auto_reload":true,"adfox":{"ownerId":228129,"params":{"p1":"cmtwf","p2":"gazs"}}},{"id":20,"label":"Leftbar button: D","provider":"adfox","adaptive":["desktop"],"adfox":{"ownerId":228129,"params":{"p1":"chfbk","p2":"gnwc"}}},{"id":21,"label":"Header Microteaser: D","provider":"adfox","adaptive":["desktop"],"adfox":{"ownerId":228129,"params":{"pp":"g","ps":"cndo","p2":"gtjk"}}},{"id":23,"label":"In Article: D","provider":"adfox","adaptive":["desktop"],"adfox":{"ownerId":228129,"params":{"pp":"g","ps":"cndo","p2":"hiig"}}}]                </textarea>
            </air>
        
                            <air module="module.hawk">
                
                <textarea air-settings>
                    {"token":"eyJpbnRlZ3JhdGlvbklkIjoiOWMxODhjZGQtMWM4NS00YmYzLWJmNmQtNDk5ZDE4NjdmOGNmIiwic2VjcmV0IjoiYzUwNzE4ZmEtZDUwMC00OTA1LWIzZDYtY2RlYmNhMzU3YjY0In0=","release":"13a984d7"}                </textarea>
            </air>
        
                <air module="module.liveStream">
            <air-settings>
                null            </air-settings>
        </air>

        
        <script>
            window.__delegated_data = {"module.page":{"navigation_name":"user_blog","sorting_name":"popular","is_content":true,"subsite":{"id":368039,"name":"Могучая кучка","avatar":{"type":"image","data":{"uuid":"b012476b-a9da-59fd-ab33-935759ac940e","width":921,"height":1164,"size":454539,"type":"png","color":"5c710f","hash":"76664e9e97ab6979","external_service":[]}},"uri":"","url":"https:\/\/tjournal.ru\/u\/368039-moguchaya-kuchka"},"layout_options":{"content":"content-entry","leftColumn":"left-column-on","rightColumn":"right-column-on","propaganda":"propaganda-on","livestream":"livestream-on","contentSidebarAlign":"content-sidebar-align-right","rightColumnReserve":"right-column-reserve-off"}},"module.ajaxify":{"title":" на TJ"},"module.auth":{"subscribed_ids":[],"ignored_ids":[]},"module.sidebar":{"desktop":[{"name":"siteNavigation","type":"tree-list","options":{"caption":{"text":""},"limit":0,"items":[{"text":"Популярное","url":"\/popular","icon":"ui_sidebar_feed","gtm":"Menu — Popular Feed — Click"},{"text":"Свежее","url":"\/new","icon":"ui_sidebar_recent_big","gtm":"Menu — New Feed — Click"},{"text":"Рейтинг TJ","url":"\/rating","slug":"Subsites rating","icon":"ui_sidebar_rating"},{"text":"Подписки","url":"\/subs","slug":"subscriptions","icon":"ui_sidebar_subscriptions"},{"text":"{<div class=\"propaganda\" data-id=\"20\"><\/div>}","url":""}],"gtm":["Sidebar","SiteNavigation"]}},{"name":"subscriptions","type":"tree-list","options":{"caption":{"text":""},"limit":5,"items":[{"text":"Новости","url":"https:\/\/tjournal.ru\/news","id":245416,"image":{"type":"image","data":{"uuid":"2810b9bb-071f-8a49-2290-2f92ca6797cd","width":400,"height":400,"size":23206,"type":"png","color":"fbf3e3","hash":"","external_service":[]}},"favourite":false},{"text":"Интернет","url":"https:\/\/tjournal.ru\/internet","id":214343,"image":{"type":"image","data":{"uuid":"74355c2a-cf87-ffba-aebf-45ae3bc8d1d8","width":450,"height":450,"size":339134,"type":"png","color":"fb34b3","hash":"12120f574f0527","external_service":[]}},"favourite":false},{"text":"Разборы","url":"https:\/\/tjournal.ru\/analysis","id":245417,"image":{"type":"image","data":{"uuid":"98aa07b9-378a-08b8-c4db-f9796f86b494","width":400,"height":400,"size":27162,"type":"png","color":"050505","hash":"","external_service":[]}},"favourite":false},{"text":"Истории","url":"https:\/\/tjournal.ru\/stories","id":214351,"image":{"type":"image","data":{"uuid":"acd98182-a0f2-6b68-5bec-1f6d9d46e7fe","width":200,"height":200,"size":114876,"type":"png","color":"480e0c","hash":"","external_service":[]}},"favourite":false},{"text":"Технологии","url":"https:\/\/tjournal.ru\/tech","id":214344,"image":{"type":"image","data":{"uuid":"6b3d55b6-65a0-129c-18da-09ee4d987819","width":400,"height":400,"size":421938,"type":"png","color":"1e60d9","hash":"","external_service":[]}},"favourite":false},{"text":"Гость TJ","url":"https:\/\/tjournal.ru\/guest","id":245667,"image":{"type":"image","data":{"uuid":"a943773f-e9f6-b225-1bdf-417debc7647c","width":600,"height":600,"size":457455,"type":"png","color":"8e9d6c","hash":"","external_service":[]}},"favourite":false}],"gtm":["Sidebar","Subscriptions"]}},{"name":"footer","type":"footer","options":{"links":{"ios":"https:\/\/itunes.apple.com\/ru\/app\/id683103523","android":"https:\/\/play.google.com\/store\/apps\/details?id=ru.kraynov.app.tjournal"},"sponsor":{"title":"Спонсоры TJ","href":"\/plus"}}}],"mobile":[{"name":"siteNavigation","type":"tree-list","options":{"caption":{"text":""},"limit":0,"items":[{"text":"Популярное","url":"\/popular","icon":"ui_sidebar_feed","gtm":"Menu — Popular Feed — Click"},{"text":"Свежее","url":"\/new","icon":"ui_sidebar_recent_big","gtm":"Menu — New Feed — Click"},{"text":"Рейтинг TJ","url":"\/rating","slug":"Subsites rating","icon":"ui_sidebar_rating"},{"text":"Подписки","url":"\/subs","slug":"subscriptions","icon":"ui_sidebar_subscriptions"},{"text":"{<div class=\"propaganda\" data-id=\"20\"><\/div>}","url":""}],"gtm":["Sidebar","SiteNavigation"]}},{"name":"writeButton","type":"write-button","options":{"text":"Новая запись"}},{"name":"subscriptions","type":"tree-list","options":{"caption":{"text":""},"limit":5,"items":[{"text":"Новости","url":"https:\/\/tjournal.ru\/news","id":245416,"image":{"type":"image","data":{"uuid":"2810b9bb-071f-8a49-2290-2f92ca6797cd","width":400,"height":400,"size":23206,"type":"png","color":"fbf3e3","hash":"","external_service":[]}},"favourite":false},{"text":"Интернет","url":"https:\/\/tjournal.ru\/internet","id":214343,"image":{"type":"image","data":{"uuid":"74355c2a-cf87-ffba-aebf-45ae3bc8d1d8","width":450,"height":450,"size":339134,"type":"png","color":"fb34b3","hash":"12120f574f0527","external_service":[]}},"favourite":false},{"text":"Разборы","url":"https:\/\/tjournal.ru\/analysis","id":245417,"image":{"type":"image","data":{"uuid":"98aa07b9-378a-08b8-c4db-f9796f86b494","width":400,"height":400,"size":27162,"type":"png","color":"050505","hash":"","external_service":[]}},"favourite":false},{"text":"Истории","url":"https:\/\/tjournal.ru\/stories","id":214351,"image":{"type":"image","data":{"uuid":"acd98182-a0f2-6b68-5bec-1f6d9d46e7fe","width":200,"height":200,"size":114876,"type":"png","color":"480e0c","hash":"","external_service":[]}},"favourite":false},{"text":"Технологии","url":"https:\/\/tjournal.ru\/tech","id":214344,"image":{"type":"image","data":{"uuid":"6b3d55b6-65a0-129c-18da-09ee4d987819","width":400,"height":400,"size":421938,"type":"png","color":"1e60d9","hash":"","external_service":[]}},"favourite":false},{"text":"Гость TJ","url":"https:\/\/tjournal.ru\/guest","id":245667,"image":{"type":"image","data":{"uuid":"a943773f-e9f6-b225-1bdf-417debc7647c","width":600,"height":600,"size":457455,"type":"png","color":"8e9d6c","hash":"","external_service":[]}},"favourite":false}],"gtm":["Sidebar","Subscriptions"]}},{"name":"footer","type":"footer","options":{"links":{"ios":"https:\/\/itunes.apple.com\/ru\/app\/id683103523","android":"https:\/\/play.google.com\/store\/apps\/details?id=ru.kraynov.app.tjournal"},"sponsor":{"title":"Спонсоры TJ","href":"\/plus"}}}]}};
            /**
             * @deprecated              */
            window.__codename = 'tj';
            window.__apptitle = 'TJ';
            /**
             * @deprecated              */
            window.__domain = 'tjournal.ru';
            window.__apple_web_push_id = 'web.ru.tjournal.push';
            window.__static_version = '13a984d7';
            window.__specials_version = '96562175';
            window.__static_path = '/static/build/tjournal.ru';
            window.__email_auth = true;
            window.__email_registration = true;
            window.__auth_cover_images = 'b6bd61b5-eb5b-34db-8501-2fcc54cd051b';
            window.__auth_logo_width = 35;
            window.__auth_logo_height = 35;
            window.__auth_logo_color = '#000000';
            window.__auth_buttons = ["email","vk","gg","fb","tw","apple"];
            window.__debug = false;
            window.__ad_site_name = 'TJournal';
            window.__is_app = false;
            window.__global_modules = 'module.appDocumentResize, module.page, module.ajaxify, module.fingerprint, module.static_version_watcher, module.popup, module.misprint, module.pixels, module.buyClubAccount, module.universal_action, module.iframe_lazy_load, module.audio_controller, module.analytics, module.analytics_events, module.clickhouse_analytics, module.captcha, module.one, module.subsite_admin, module.sidebar, module.nativeAd, module.andropov, module.inputs, module.push2, module.radioButtons, module.checkboxes, module.evaluate_script, module.hawk, module.comments, module.instagram_frames, module.auth, module.subsitesTunePopup, module.newEntriesHorizon, module.boosterConstructor, module.actionsAnalytics, module.writing, module.scrollLocker, module.live, module.distribution, module.vueMate';
            window.__dates_behavior = {"daily":{"[today]":"{time} \/\/ 3600","*":"{dayN}.{monthNN} \/\/ 0"},"full":{"[thisyear]":"{dayN} {monthShort} \u0432 {time} \/\/ 3600","*":"{dayN}.{monthNN}.{year} \u0432 {time} \/\/ 3600"},"[:59sec]":{"short":"\/\/ 30","medium":"\u0441\u0435\u0439\u0447\u0430\u0441 \/\/ 30","*":"\u0442\u043e\u043b\u044c\u043a\u043e \u0447\u0442\u043e \/\/ 30"},"[:119sec]":{"short":"{minDiff}\u043c \/\/ 30","medium":"{minDiff} \u043c\u0438\u043d \/\/ 30","*":"\u043c\u0438\u043d\u0443\u0442\u0443 \u043d\u0430\u0437\u0430\u0434 \/\/ 30"},"[:59.9min]":{"short":"{minDiff}\u043c \/\/ 60","medium":"{minDiff} \u043c\u0438\u043d \/\/ 60","*":"{minDiff} {minDiffWord} \u043d\u0430\u0437\u0430\u0434 \/\/ 60"},"[:119.9min]":{"short":"{hourDiff}\u0447 \/\/ 1800","medium":"{hourDiff} {hourDiffWord} \/\/ 60","*":"\u0447\u0430\u0441 \u043d\u0430\u0437\u0430\u0434 \/\/ 1800"},"medium":{"[:719min]":"{hourDiff} {hourDiffWord} \/\/ 60"},"[:4hour]":{"short":"{hourDiff}\u0447 \/\/ 1800","*":"{hourDiff} {hourDiffWord} \u043d\u0430\u0437\u0430\u0434 \/\/ 1800"},"[today]":{"short":"{time} \/\/ 3600","medium":"{time} \/\/ 3600","*":"\u0441\u0435\u0433\u043e\u0434\u043d\u044f \u0432 {time} \/\/ 3600"},"[yesterday]":{"short":"\u0432\u0447\u0435\u0440\u0430 \/\/ 3600","medium":"\u0432\u0447\u0435\u0440\u0430 \/\/ 3600","*":"\u0432\u0447\u0435\u0440\u0430 \u0432 {time} \/\/ 3600"},"[thisyear]":{"short":"{dayN} {monthShort} \/\/ 0","medium":"{dayN} {monthShort} \/\/ 0","*":"{dayN} {monthShort} \u0432 {time} \/\/ 3600"},"*":{"short":"{dayN}.{monthNN}.{year} \/\/ 0","medium":"{dayN}.{monthNN}.{year} \/\/ 0","*":"{dayN} {monthShort} {year} \/\/ 0"}};
            window.__site_logo_size = [32, 50];
            window.__bugsSubsiteId = parseInt('214364', 10);
            window.__complain_reasons = ["","\u0421\u043f\u0430\u043c","\u041e\u0441\u043a\u043e\u0440\u0431\u043b\u0435\u043d\u0438\u0435","\u041d\u0430\u0440\u0443\u0448\u0435\u043d\u0438\u0435 \u0437\u0430\u043a\u043e\u043d\u0430","\u041f\u043e\u0440\u043d\u043e\u0433\u0440\u0430\u0444\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u043a\u043e\u043d\u0442\u0435\u043d\u0442","\u041d\u0430\u0441\u0438\u043b\u0438\u0435","\u0410\u0432\u0442\u043e\u0440\u0441\u043a\u0438\u0435 \u043f\u0440\u0430\u0432\u0430","\u0412\u0432\u0435\u0434\u0435\u043d\u0438\u0435 \u0432 \u0437\u0430\u0431\u043b\u0443\u0436\u0434\u0435\u043d\u0438\u0435","\u0414\u0440\u0443\u0433\u043e\u0435"];
            window.__i18nLocale = 'ru_RU';
        </script>

        
            <script>
                /* Hide Android smart banner */
                window.addEventListener('beforeinstallprompt', function(e) {
                    e.preventDefault();
                    return false;
                });
            </script>

        
        <script>
            (function(window, document, undefined) {

                function DOMReady(onInteractive, onComplete) {
                    document.onreadystatechange = function() {
                        var state = document.readyState;

                        if (state === 'interactive' && onInteractive !== undefined) {
                            onInteractive();
                        }

                        if (state === 'complete' && onComplete !== undefined) {
                            onComplete();
                        }
                    };
                }

                function loadSvgSprite( callback ) {
                    var req = new XMLHttpRequest();

                    req.onload = function (e) {
                        /**
                         * Wrap svg element in div to avoid certain bugs (e.g. gradient fills not working)
                         * @link https://stackoverflow.com/questions/24806913/how-can-i-refer-to-an-internal-gradient-definition-inside-an-svg-sprite-symbol
                         */
                        var svgContainer = document.createElement('div');
                        var svg = document.implementation.createHTMLDocument( '' );

                        svgContainer.style.position = 'absolute';
                        svgContainer.style.width = 0;
                        svgContainer.style.height = 0;
                        svgContainer.style.overflow = 'hidden';
                        svgContainer.style.zIndex = -9999;

                        svg.body.innerHTML = e.target.response;
                        svgContainer.appendChild(svg.body.firstElementChild);
                        document.body.appendChild(svgContainer);
                        svg = null;

                        if ( callback !== undefined ) {
                            callback();
                        }
                    };

                    req.open('GET', 'https://tjournal.ru/static/build/tjournal.ru/symbols.13a984d7.svg', true);

                    req.responseType = 'text';

                    req.send();
                }

                DOMReady(function() {
                    loadSvgSprite( function() {} );
                }, function() {});

            })(window, document);
        </script>

        <script>
            /**
             * Load different js bundles depends on `module` supporting
             */
            (function (scriptTag, es6, es5) {
                var isSupportsModules = 'noModule' in scriptTag;
                var isSupportsFeatures = typeof Object.fromEntries === 'function';
                var isIe = /MSIE|Edge/.test(window.navigator.userAgent);
                var isSafari13 = typeof BigInt !== 'function'; // Detect Safari 13 through the feature it does not support, e.g. BigInt (related to issue INT-1004)

                if (isSupportsModules && isSupportsFeatures && !isIe && !isSafari13) {
                    scriptTag.type = 'module';
                    scriptTag.src = es6;
                } else {
                    scriptTag.async = true;
                    scriptTag.src = es5;
                }

                scriptTag.crossorigin = 'crossorigin';
                document.head.appendChild(scriptTag);

            })(document.createElement('script'), '../../js/main.13a984d7.es6.min.js', '../../js/main.13a984d7.es5.min.js');
        </script>

    </body>
</html>
